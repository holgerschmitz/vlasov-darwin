#include "filename.h"
#include <sstream>
#include <iostream>

void SimFileName::setReplace(std::string id, int val)
{
  replaceMap[id] = val;
}

std::string SimFileName::filename()
{
  std::cerr << "Creating file name from " << *this << std::endl;
  std::string parsed = *this;
  
  std::ostringstream comrankstr;
  comrankstr << rank;
  std::string comrank = comrankstr.str();

  std::ostringstream tstepstr;
  tstepstr << time;
  std::string tstep = tstepstr.str();
  
  std::map<std::string, int>::iterator it;
  
  for (it=replaceMap.begin(); it!=replaceMap.end(); ++it)
  {
  
   int pos = parsed.find(it->first);
   while (pos != std::string::npos)
   {
     parsed.replace(it->second,2,comrank);
     pos = parsed.find(it->first);
   }
  }

  std::cerr << "  -- " << parsed << std::endl;
  
  return parsed;
}
